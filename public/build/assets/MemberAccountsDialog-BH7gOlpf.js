import{j as e,W as B,r as M}from"./app-BbJUaZt7.js";import{I as r}from"./InputError-NIrKKB-2.js";import{B as y}from"./badge-CPae2Fh8.js";import{B as f}from"./button-UwysrHzP.js";import{C as x,a as p,b as j,c as _,d as $}from"./card-BdKu3Mnk.js";import{D as b,b as v,c as I,d as V,e as k,a as H}from"./dialog-JG440Rn_.js";import{I as m}from"./input-Cqv19wrC.js";import{L as i}from"./label-DsFCVgVZ.js";import{S as N,a as C,b as T,c as D,d as c}from"./select-Dfz_2K3P.js";import{T as Q,a as O,b as w,c as d,d as q,e as l}from"./table-BNYudrKQ.js";import{T as z}from"./textarea-iPGzJA0z.js";import{t as L}from"./use-toast-DB_HyPaF.js";import{f as W}from"./format-CE4V3joc.js";import"./index-Bb4qSo10.js";import"./utils-C-Zvzyq5.js";import"./index-8PO45I_3.js";import"./index-BAXoe19z.js";import"./index-B95Fhcwf.js";import"./index-DJQKv4up.js";import"./index-C1KCpwI9.js";import"./x-Dzg8clAH.js";import"./createLucideIcon-CPw1ASD4.js";import"./index-CXD2mk9O.js";import"./index-BM2NL8vz.js";import"./check-DjI-pqQE.js";function _e({member:o,open:R,onClose:A}){const u=Object.values(o.all_payments);console.log("legder : ",u),u.sort((a,t)=>{const n=new Date(a.updated_at||a.created_at);return new Date(t.updated_at||t.created_at).getTime()-n.getTime()});const E=()=>{const{data:a,setData:t,errors:n,post:h,processing:g,reset:S}=B({member_id:o.id,transaction_type:"",refund_amount:"",description:"",total_amount:"",paid_amount:"",payment_date:"",payment_mode:"",bill_number:"",payment_voucher:""}),P=s=>{s.preventDefault(),h("/transactions/store",{onSuccess:()=>{L({description:"Transaction created successfully..."}),S()}})};return M.useEffect(()=>{a.transaction_type==="credit-payment"&&t("total_amount","0")},[a.payment_mode]),e.jsxs(b,{children:[e.jsx(H,{asChild:!0,children:e.jsx(f,{variant:"default",className:"w-fit ms-auto",children:"Add Transaction"})}),e.jsx(v,{className:"max-w-[500px]",children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Add Transaction"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Enter the miscellaneous transaction details for ",e.jsx("strong",{children:o.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Transaction Type"}),e.jsxs(N,{value:a.transaction_type,onValueChange:s=>t("transaction_type",s),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Select transaction type"})}),e.jsxs(D,{children:[e.jsx(c,{value:"service",children:"Service"}),e.jsx(c,{value:"product",children:"Product"}),e.jsx(c,{value:"credit-payment",children:"Credit Payment"}),e.jsx(c,{value:"refund",children:"Refund"}),e.jsx(c,{value:"others",children:"Others"})]})]}),e.jsx(r,{message:n.transaction_type})]}),a.transaction_type!=="credit-payment"&&a.transaction_type!=="refund"&&e.jsxs("div",{children:[e.jsx(i,{children:"Total Amount"}),e.jsx(m,{type:"number",placeholder:"Enter total amount",value:a.total_amount,onChange:s=>t("total_amount",s.target.value)}),e.jsx(r,{message:n.total_amount})]}),a.transaction_type==="refund"&&e.jsxs("div",{children:[e.jsx(i,{children:"Refund Amount"}),e.jsx(m,{type:"number",placeholder:"Enter refund amount",value:a.refund_amount,onChange:s=>t("refund_amount",s.target.value)}),e.jsx(r,{message:n.refund_amount})]}),a.transaction_type!=="refund"&&e.jsxs("div",{children:[e.jsx(i,{children:"Payment Amount"}),e.jsx(m,{type:"number",placeholder:"Enter paid amount",value:a.paid_amount,onChange:s=>t("paid_amount",s.target.value)}),e.jsx(r,{message:n.paid_amount})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Payment Mode"}),e.jsxs(N,{value:a.payment_mode,onValueChange:s=>t("payment_mode",s),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Select payment mode"})}),e.jsxs(D,{children:[e.jsx(c,{value:"Cash",children:"Cash"}),e.jsx(c,{value:"QR",children:"QR"}),e.jsx(c,{value:"Cash + QR",children:"Cash + QR"}),e.jsx(c,{value:"Cheque",children:"Cheque"})]})]}),e.jsx(r,{message:n.payment_mode})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Payment Date"}),e.jsx(m,{type:"date",value:a.payment_date,onChange:s=>t("payment_date",s.target.value)}),e.jsx(r,{message:n.payment_date})]}),a.transaction_type!=="refund"&&e.jsxs("div",{className:a.transaction_type==="credit-payment"?"col-span-full":"",children:[e.jsx(i,{children:"Bill Number (optional)"}),e.jsx(m,{placeholder:"Enter bill number (if applicable)",onChange:s=>t("bill_number",s.target.value)}),e.jsx(r,{message:n.bill_number})]}),a.transaction_type==="refund"&&e.jsxs("div",{className:"col-span-full",children:[e.jsx(i,{children:"Payment Voucher"}),e.jsx(m,{placeholder:"Enter payment voucher number",onChange:s=>t("payment_voucher",s.target.value)}),e.jsx(r,{message:n.payment_voucher})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Description"}),e.jsx(z,{placeholder:"Enter description of the transaction",value:a.description,onChange:s=>t("description",s.target.value)}),e.jsx(r,{message:n.description})]}),e.jsx(f,{type:"submit",className:"mt-4 w-full",disabled:g,children:g?"Processing...":"Create Transaction"})]})})]})};return e.jsx(b,{open:R,onOpenChange:A,children:e.jsxs(v,{className:"max-w-[1600px] w-[95vw] max-h-[99vh] overflow-auto",children:[e.jsxs(I,{children:[e.jsx(V,{children:"Member Transactions"}),e.jsx(k,{children:"Efficiently analyze the payments of a member."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(x,{className:"bg-blue-500",children:e.jsxs(p,{children:[e.jsx(j,{className:"text-white",children:u.length}),e.jsx(_,{className:"text-white/80",children:"Total Transactions"})]})}),e.jsx(x,{className:"bg-fuchsia-600",children:e.jsxs(p,{children:[e.jsxs(j,{className:"text-white",children:[" Rs ",u.reduce((a,t)=>{const n=Number(t.paid_amount)||0,h=Number(t.refund_amount)||0;return a+n-h},0)]}),e.jsx(_,{className:"text-white/80",children:"Total Paid Amount"})]})}),e.jsx(x,{className:o.credit>0?"bg-red-500":"bg-green-500",children:e.jsxs(p,{children:[e.jsxs(j,{className:"text-white",children:["Rs ",Math.abs(Number(o.credit))]}),e.jsxs(_,{className:"text-white/80",children:["Total ",o.credit<=0?" Advance ":" Credit "," Amount"]})]})})]}),e.jsx("div",{className:"w-fit ms-auto space-x-2",children:e.jsx(E,{})}),e.jsx(x,{children:e.jsx($,{children:e.jsxs(Q,{className:"text-center",children:[e.jsx(O,{children:e.jsxs(w,{className:"hover:bg-card",children:[e.jsx(d,{className:"text-center",children:"Date"}),e.jsx(d,{className:"text-center",children:"Total"}),e.jsx(d,{className:"text-center",children:"Extra Disc."}),e.jsx(d,{className:"text-center",children:"Paid"}),e.jsx(d,{className:"text-center",children:"Credit/Adv."}),e.jsx(d,{className:"text-center",children:"Bill/PV No."}),e.jsx(d,{className:"text-center",children:"Transaction Type"}),e.jsx(d,{className:"text-center",children:"Payment Mode"}),e.jsx(d,{className:"text-center",children:"Remarks"})]})}),e.jsx(q,{children:u.map(a=>{const t=a.paid_amount?Number(a.net_amount-a.paid_amount):Number(a.net_amount);return e.jsxs(w,{className:"hover:bg-muted/15",children:[e.jsx(l,{children:W(new Date(a.payment_date||a.created_at),"MMM d, yyyy")}),e.jsx(l,{children:Number(a.refund_amount)?`Rs ${Number(a.refund_amount)}`:`Rs ${Number(a.net_amount)}`}),e.jsx(l,{children:a.extra_discount?`Rs ${Number(a.extra_discount)}`:"-"}),e.jsx(l,{children:a.paid_amount?`Rs ${Number(a.paid_amount)}`:"-"}),e.jsx(l,{children:a.refund_amount?"":e.jsx("small",{className:"px-3 py-1 rounded-full text-white font-bold "+(t>0?"bg-red-500":t<0?"bg-green-500":"text-black"),children:t>=0?`Rs ${t}`:`Rs ${Math.abs(t)}`})}),e.jsx(l,{children:a.bill_number?e.jsx(y,{children:a.bill_number}):e.jsx(y,{children:a.payment_voucher})}),e.jsxs(l,{className:"capitalize",children:[a.type||"Credit Added",a.locker_months>0?e.jsx("span",{children:" + locker"}):""]}),e.jsx(l,{children:a.payment_mode||"-"}),e.jsx(l,{children:a.description||"-"})]},a.id)})})]})})})]})})}export{_e as MemberAccountsDialog};
