import{j as e,W as B,r as M}from"./app-D3xhd7x4.js";import{I as c}from"./InputError-DKuUmmK1.js";import{B as f}from"./badge-BnluvayJ.js";import{B as y}from"./button-kSVH6inc.js";import{C as h,a as p,b as j,c as _,d as k}from"./card-XJZW572Q.js";import{D as b,b as v,c as V,d as $,e as I,a as H}from"./dialog-CoUukDiU.js";import{I as m}from"./input-B5jvm_hA.js";import{L as l}from"./label-B7b8UO_Y.js";import{S as N,a as C,b as T,c as w,d}from"./select-U6-rirhH.js";import{T as Q,a as O,b as D,c as r,d as q,e as i}from"./table-nOQc-wFK.js";import{T as z}from"./textarea-lKWceivU.js";import{t as L}from"./use-toast-CeK-EtdP.js";import{f as W}from"./format-CE4V3joc.js";import"./index-Bb4qSo10.js";import"./utils-C-Zvzyq5.js";import"./index-BN1U6-Hz.js";import"./index-BA9ojx9c.js";import"./index-BkFfMWl8.js";import"./index-CHWu3Xan.js";import"./index-D_4hUVl6.js";import"./x-n02M-ldN.js";import"./createLucideIcon-RljSjpz3.js";import"./index-DjfCHU90.js";import"./index-CQ59I0Dq.js";import"./check-CcE03I2l.js";function _e({member:o,open:A,onClose:R}){const u=Object.values(o.all_payments);console.log("legder : ",u),u.sort((a,t)=>{const n=new Date(a.updated_at||a.created_at);return new Date(t.updated_at||t.created_at).getTime()-n.getTime()});const E=()=>{const{data:a,setData:t,errors:n,post:x,processing:g,reset:P}=B({member_id:o.id,transaction_type:"",refund_amount:"",description:"",total_amount:"",paid_amount:"",payment_date:"",payment_mode:"",bill_number:"",payment_voucher:""}),S=s=>{s.preventDefault(),x("/transactions/store",{onSuccess:()=>{L({description:"Transaction created successfully..."}),P()}})};return M.useEffect(()=>{a.transaction_type==="credit-payment"&&t("total_amount","0")},[a.payment_mode]),e.jsxs(b,{children:[e.jsx(H,{asChild:!0,children:e.jsx(y,{variant:"default",className:"w-fit ms-auto",children:"Add Transaction"})}),e.jsx(v,{className:"max-w-[500px]",children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Add Transaction"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Enter the miscellaneous transaction details for ",e.jsx("strong",{children:o.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Transaction Type"}),e.jsxs(N,{value:a.transaction_type,onValueChange:s=>t("transaction_type",s),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Select transaction type"})}),e.jsxs(w,{children:[e.jsx(d,{value:"service",children:"Service"}),e.jsx(d,{value:"product",children:"Product"}),e.jsx(d,{value:"credit-payment",children:"Credit Payment"}),e.jsx(d,{value:"refund",children:"Refund"}),e.jsx(d,{value:"others",children:"Others"})]})]}),e.jsx(c,{message:n.transaction_type})]}),a.transaction_type!=="credit-payment"&&a.transaction_type!=="refund"&&e.jsxs("div",{children:[e.jsx(l,{children:"Total Amount"}),e.jsx(m,{type:"number",placeholder:"Enter total amount",value:a.total_amount,onChange:s=>t("total_amount",s.target.value)}),e.jsx(c,{message:n.total_amount})]}),a.transaction_type==="refund"&&e.jsxs("div",{children:[e.jsx(l,{children:"Refund Amount"}),e.jsx(m,{type:"number",placeholder:"Enter refund amount",value:a.refund_amount,onChange:s=>t("refund_amount",s.target.value)}),e.jsx(c,{message:n.refund_amount})]}),a.transaction_type!=="refund"&&e.jsxs("div",{children:[e.jsx(l,{children:"Payment Amount"}),e.jsx(m,{type:"number",placeholder:"Enter paid amount",value:a.paid_amount,onChange:s=>t("paid_amount",s.target.value)}),e.jsx(c,{message:n.paid_amount})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Payment Mode"}),e.jsxs(N,{value:a.payment_mode,onValueChange:s=>t("payment_mode",s),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Select payment mode"})}),e.jsxs(w,{children:[e.jsx(d,{value:"Cash",children:"Cash"}),e.jsx(d,{value:"QR",children:"QR"}),e.jsx(d,{value:"Cash + QR",children:"Cash + QR"}),e.jsx(d,{value:"Cheque",children:"Cheque"})]})]}),e.jsx(c,{message:n.payment_mode})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Payment Date"}),e.jsx(m,{type:"date",value:a.payment_date,onChange:s=>t("payment_date",s.target.value)}),e.jsx(c,{message:n.payment_date})]}),a.transaction_type!=="refund"&&e.jsxs("div",{className:a.transaction_type==="credit-payment"?"col-span-full":"",children:[e.jsx(l,{children:"Bill Number (optional)"}),e.jsx(m,{placeholder:"Enter bill number (if applicable)",onChange:s=>t("bill_number",s.target.value)}),e.jsx(c,{message:n.bill_number})]}),a.transaction_type==="refund"&&e.jsxs("div",{className:"col-span-full",children:[e.jsx(l,{children:"Payment Voucher"}),e.jsx(m,{placeholder:"Enter payment voucher number",onChange:s=>t("payment_voucher",s.target.value)}),e.jsx(c,{message:n.payment_voucher})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Description"}),e.jsx(z,{placeholder:"Enter description of the transaction",value:a.description,onChange:s=>t("description",s.target.value)}),e.jsx(c,{message:n.description})]}),e.jsx(y,{type:"submit",className:"mt-4 w-full",disabled:g,children:g?"Processing...":"Create Transaction"})]})})]})};return e.jsx(b,{open:A,onOpenChange:R,children:e.jsxs(v,{className:"max-w-[1600px] w-[95vw] max-h-[99vh] overflow-auto",children:[e.jsxs(V,{children:[e.jsx($,{children:"Member Transactions"}),e.jsx(I,{children:"Efficiently analyze the payments of a member."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(h,{className:"bg-blue-500",children:e.jsxs(p,{children:[e.jsx(j,{className:"text-white",children:u.length}),e.jsx(_,{className:"text-white/80",children:"Total Transactions"})]})}),e.jsx(h,{className:"bg-fuchsia-600",children:e.jsxs(p,{children:[e.jsxs(j,{className:"text-white",children:[" Rs ",u.reduce((a,t)=>{const n=Number(t.paid_amount)||0,x=Number(t.refund_amount)||0;return a+n-x},0)]}),e.jsx(_,{className:"text-white/80",children:"Total Paid Amount"})]})}),e.jsx(h,{className:o.credit>0?"bg-red-500":"bg-green-500",children:e.jsxs(p,{children:[e.jsxs(j,{className:"text-white",children:["Rs ",Math.abs(Number(o.credit))]}),e.jsxs(_,{className:"text-white/80",children:["Total ",o.credit<=0?" Advance ":" Credit "," Amount"]})]})})]}),e.jsx("div",{className:"w-fit ms-auto space-x-2",children:e.jsx(E,{})}),e.jsx(h,{children:e.jsx(k,{children:e.jsxs(Q,{className:"text-center",children:[e.jsx(O,{children:e.jsxs(D,{className:"hover:bg-card",children:[e.jsx(r,{className:"text-center",children:"Date"}),e.jsx(r,{className:"text-center",children:"Total"}),e.jsx(r,{className:"text-center",children:"Extra Disc."}),e.jsx(r,{className:"text-center",children:"Paid"}),e.jsx(r,{className:"text-center",children:"Credit/Adv."}),e.jsx(r,{className:"text-center",children:"Bill/PV No."}),e.jsx(r,{className:"text-center",children:"Transaction Type"}),e.jsx(r,{className:"text-center",children:"Payment Mode"}),e.jsx(r,{className:"text-center",children:"Payment Proof"}),e.jsx(r,{className:"text-center",children:"Remarks"})]})}),e.jsx(q,{children:u.map(a=>{const t=a.paid_amount?Number(a.net_amount-a.paid_amount):Number(a.net_amount);return e.jsxs(D,{className:"hover:bg-muted/15",children:[e.jsx(i,{children:W(new Date(a.payment_date||a.created_at),"MMM d, yyyy")}),e.jsx(i,{children:Number(a.refund_amount)?`Rs ${Number(a.refund_amount)}`:`Rs ${Number(a.total_monthly_fees)+Number(a.admission_fees)-Number(a.package_discount)}`}),e.jsx(i,{children:a.extra_discount?`Rs ${Number(a.extra_discount)}`:"-"}),e.jsx(i,{children:a.paid_amount?`Rs ${Number(a.paid_amount)}`:"-"}),e.jsx(i,{children:a.refund_amount?"":e.jsx("small",{className:"px-3 py-1 rounded-full text-white font-bold "+(t>0?"bg-red-500":t<0?"bg-green-500":"text-black"),children:t>=0?`Rs ${t}`:`Rs ${Math.abs(t)}`})}),e.jsx(i,{children:a.bill_number?e.jsx(f,{children:a.bill_number}):e.jsx(f,{children:a.payment_voucher})}),e.jsxs(i,{className:"capitalize",children:[a.type||"Credit Added",a.locker_months>0?e.jsx("span",{children:" + locker"}):""]}),e.jsx(i,{children:a.payment_mode||"-"}),e.jsx(i,{children:a.payment_proof?e.jsx("a",{href:a.payment_proof,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 underline hover:text-purple-700",children:"View"}):e.jsx("span",{className:"text-muted-foreground",children:"Not Available"})}),e.jsx(i,{children:a.description||"-"})]},a.id)})})]})})})]})})}export{_e as MemberAccountsDialog};
