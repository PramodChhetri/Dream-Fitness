import{j as e,W as B,r as M}from"./app-3SIRTf-5.js";import{I as l}from"./InputError-BCZ6gpxT.js";import{B as P}from"./badge-N3QcmQek.js";import{B as y}from"./button-mE5Zer4v.js";import{C as x,a as p,b as u,c as j,d as k}from"./card-CBtJbqk1.js";import{D as _,b as N,c as I,d as $,e as H,a as Q}from"./dialog-HXmWLQJG.js";import{I as h}from"./input-B_VqwVNS.js";import{L as d}from"./label-sM4Vfyun.js";import{S as v,a as f,b as T,c as C,d as c}from"./select-BAAnM0MM.js";import{T as O,a as V,b as D,c as n,d as q,e as i}from"./table-EyrCOfFI.js";import{T as z}from"./textarea-BAe97Pwd.js";import{t as L}from"./use-toast-D1Qu1tBf.js";import{f as W}from"./format-CE4V3joc.js";import"./index-Bb4qSo10.js";import"./utils-C-Zvzyq5.js";import"./index-C3fbTtBW.js";import"./index-SipnJt1m.js";import"./index-YuXTghCy.js";import"./index-Cqu9cwS9.js";import"./index-BVcS-tUL.js";import"./x-ZThs6_Gk.js";import"./createLucideIcon-a0XJ54KJ.js";import"./index-BwJKMgpa.js";import"./index-v8WOfFnQ.js";function je({member:o,open:w,onClose:R}){const m=Object.values(o.all_payments);m.sort((a,s)=>{const r=new Date(a.payment_date||a.created_at);return new Date(s.payment_date||s.created_at).getTime()-r.getTime()});const A=()=>{const{data:a,setData:s,errors:r,post:g,processing:b,reset:S}=B({member_id:o.id,transaction_type:"",description:"",total_amount:"",paid_amount:"",payment_date:"",payment_mode:"",bill_number:""}),E=t=>{t.preventDefault(),g("/transactions/store",{onSuccess:()=>{L({description:"Transaction created successfully..."}),S()}})};return M.useEffect(()=>{a.transaction_type==="credit-payment"&&s("total_amount","0")},[a.payment_mode]),e.jsxs(_,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(y,{variant:"default",className:"w-fit ms-auto",children:"Add Transaction"})}),e.jsx(N,{className:"max-w-[500px]",children:e.jsxs("form",{onSubmit:E,className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Add Transaction"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Enter the miscellaneous transaction details for ",e.jsx("strong",{children:o.name})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Transaction Type"}),e.jsxs(v,{value:a.transaction_type,onValueChange:t=>s("transaction_type",t),children:[e.jsx(f,{children:e.jsx(T,{placeholder:"Select transaction type"})}),e.jsxs(C,{children:[e.jsx(c,{value:"service",children:"Service"}),e.jsx(c,{value:"product",children:"Product"}),e.jsx(c,{value:"credit-payment",children:"Credit Payment"}),e.jsx(c,{value:"others",children:"Others"})]})]}),e.jsx(l,{message:r.transaction_type})]}),a.transaction_type!=="credit-payment"?e.jsxs("div",{children:[e.jsx(d,{children:"Total Amount"}),e.jsx(h,{type:"number",placeholder:"Enter total amount",value:a.total_amount,onChange:t=>s("total_amount",t.target.value)}),e.jsx(l,{message:r.total_amount})]}):"",e.jsxs("div",{children:[e.jsx(d,{children:"Payment Amount"}),e.jsx(h,{type:"number",placeholder:"Enter paid amount",value:a.paid_amount,onChange:t=>s("paid_amount",t.target.value)}),e.jsx(l,{message:r.paid_amount})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Payment Mode"}),e.jsxs(v,{value:a.payment_mode,onValueChange:t=>s("payment_mode",t),children:[e.jsx(f,{children:e.jsx(T,{placeholder:"Select payment mode"})}),e.jsxs(C,{children:[e.jsx(c,{value:"Cash",children:"Cash"}),e.jsx(c,{value:"QR",children:"QR"}),e.jsx(c,{value:"Cash + QR",children:"Cash + QR"}),e.jsx(c,{value:"Cheque",children:"Cheque"})]})]}),e.jsx(l,{message:r.payment_mode})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Payment Date"}),e.jsx(h,{type:"date",value:a.payment_date,onChange:t=>s("payment_date",t.target.value)}),e.jsx(l,{message:r.payment_date})]}),e.jsxs("div",{className:a.transaction_type==="credit-payment"?"col-span-full":"",children:[e.jsx(d,{children:"Bill Number (optional)"}),e.jsx(h,{placeholder:"Enter bill number (if applicable)",onChange:t=>s("bill_number",t.target.value)}),e.jsx(l,{message:r.bill_number})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 mt-4",children:e.jsxs("div",{children:[e.jsx(d,{children:"Description"}),e.jsx(z,{placeholder:"Enter Description of the transaction",value:a.description,onChange:t=>s("description",t.target.value)}),e.jsx(l,{message:r.description})]})}),e.jsx(y,{type:"submit",className:"mt-4 w-full",disabled:b,children:b?"Processing...":"Create Transaction"})]})]})})]})};return e.jsx(_,{open:w,onOpenChange:R,children:e.jsxs(N,{className:"max-w-[1600px] w-[95vw] max-h-[99vh] overflow-auto",children:[e.jsxs(I,{children:[e.jsx($,{children:"Member Transactions"}),e.jsx(H,{children:"Efficiently analyze the payments of a member."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(x,{className:"bg-blue-500",children:e.jsxs(p,{children:[e.jsx(u,{className:"text-white",children:m.length}),e.jsx(j,{className:"text-white/80",children:"Total Transactions"})]})}),e.jsx(x,{className:"bg-fuchsia-600",children:e.jsxs(p,{children:[e.jsxs(u,{className:"text-white",children:["Rs ",m.reduce((a,s)=>a+Number(s.paid_amount),0)]}),e.jsx(j,{className:"text-white/80",children:"Total Paid Amount"})]})}),e.jsx(x,{className:o.credit>0?"bg-red-500":"bg-green-500",children:e.jsxs(p,{children:[e.jsxs(u,{className:"text-white",children:["Rs ",Math.abs(Number(o.credit))]}),e.jsxs(j,{className:"text-white/80",children:["Total ",o.credit<=0?" Advance ":" Credit "," Amount"]})]})})]}),e.jsx("div",{className:"w-fit ms-auto space-x-2",children:e.jsx(A,{})}),e.jsx(x,{children:e.jsx(k,{children:e.jsxs(O,{className:"text-center",children:[e.jsx(V,{children:e.jsxs(D,{className:"hover:bg-card",children:[e.jsx(n,{className:"text-center",children:"Date"}),e.jsx(n,{className:"text-center",children:"Total"}),e.jsx(n,{className:"text-center",children:"Extra Disc."}),e.jsx(n,{className:"text-center",children:"Paid"}),e.jsx(n,{className:"text-center",children:"Credit/Adv."}),e.jsx(n,{className:"text-center",children:"Bill No."}),e.jsx(n,{className:"text-center",children:"Transaction Type"}),e.jsx(n,{className:"text-center",children:"Payment Mode"}),e.jsx(n,{className:"text-center",children:"Remarks"})]})}),e.jsx(q,{children:m.map(a=>{const s=a.paid_amount?Number(a.net_amount-a.paid_amount):Number(a.net_amount);return e.jsxs(D,{className:"hover:bg-muted/15",children:[e.jsx(i,{children:W(new Date(a.payment_date||a.created_at),"MMM d, yyyy")}),e.jsx(i,{children:Number(a.net_amount)?`Rs ${Number(a.net_amount)}`:"-"}),e.jsx(i,{children:a.extra_discount?`Rs ${Number(a.extra_discount)}`:"-"}),e.jsx(i,{children:a.paid_amount?`Rs ${Number(a.paid_amount)}`:"-"}),e.jsx(i,{children:e.jsx("small",{className:"px-3 py-1 rounded-full text-white font-bold "+(s>0?"bg-red-500":s<0?"bg-green-500":"text-black"),children:s>=0?`Rs ${s}`:`Rs ${Math.abs(s)}`})}),e.jsx(i,{children:a.bill_number?e.jsx(P,{children:a.bill_number}):"-"}),e.jsxs(i,{className:"capitalize",children:[a.type||"Credit Added",a.locker_months>0?e.jsx("span",{children:" + locker"}):""]}),e.jsx(i,{children:a.payment_mode||"-"}),e.jsx(i,{children:a.remarks||"-"})]},a.id)})})]})})})]})})}export{je as MemberAccountsDialog};
